<!doctype html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
</head>
<title>Bundling Example</title>
<link rel="stylesheet" type="text/css" href="../d3.parcoords.css">
<link rel="stylesheet" type="text/css" href="../d3.slider.css">
<link rel="stylesheet" type="text/css" href="style.css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="lib/sylvester.js"></script>
<script src="lib/lodash.js"></script>
<script src="lib/jquery-1.7.min.js"></script>
<script src="lib/underscore.js"></script>
<script src="lib/underscore.math.js"></script>
<script src="lib/d3.svg.multibrush.js"></script>
<script src="lib/divgrid.js"></script>
<script src="../d3.parcoords.js"></script>
<script src="../d3.slider.js"></script>


<style>
/* data table styles */
#grid { height: 198px; }
.row, .header { clear: left; font-size: 12px; line-height: 18px; height: 18px; }
.row:nth-child(odd) { background: rgba(0,0,0,0.05); }
.header { font-weight: bold; }
.cell { float: left; overflow: hidden; white-space: nowrap; width: 70px; height: 18px; }
.col-0 { width: 120px; }
.col-1 { width: 120px; }
</style>




<h3>NCAA</h3>


<p>Use this slider to change the curve smoothness. The current value is <strong id="smooth">0.12</strong><br/>
<input type="range" min="0" max="0.25" value="0.12" step="0.01" id="smoothness"/>
<p>Use this slider to change the bundling strength. The current value is <strong id="strength">0.3</strong><br/>
<input type="range" min="0" max="1" value="0.3" step="0.05" id="bundling"/>
<div id="bundleDimension">Bundle using clusters determined by: </div>
<div id="example0" class="parcoords" style="width:1140px;height:200px"></div>
<div id="example1" class="parcoords" style="width:1140px;height:200px"></div>



<div id="grid0"></div>
<div id="grid1"></div>

<p>Count wins of chart1 vs. chart2: 
  <button id="compare">Compare</button>
  <strong id="t1wins">0.0</strong>  vs.  <strong id="t2wins">0.0</strong>
</p>

<div style="width: 100%; overflow: hidden">
<div id="table1" style="width:40%; float: left;"></div>
<div id="table2" style="float:left; width:40%;"></div>
</div>

<div id="grid01"></div>
<div id="grid11"></div>


<script>

// quantitative color scale
var blue_to_brown = d3.scale.linear()
  .domain([1, 351])
  .range(["steelblue", "brown"])
  .interpolate(d3.interpolateLab);

var color = function(d) { return blue_to_brown(d['Ranking']); };

var pc0;

d3.csv('data/avg2016stats.csv', function(data) {

pc0 = d3.parcoords()("#example0")
  .color(color)
  .alpha(0.35)
  .data(data)
	.bundlingStrength(0.3) // set bundling strength
	.smoothness(0.12)
	.bundleDimension("or")
	.showControlPoints(false)
	.hideAxis(["Team_Name"])
	.render()
	.brushMode("1D-axes")
	.reorderable()
	.interactive();

pc1 = d3.parcoords()("#example1")
  .color(color)
  .alpha(0.35)
  .data(data)
	.bundlingStrength(0.3) // set bundling strength
	.smoothness(0.12)
	.bundleDimension("or")
	.showControlPoints(false)
	.hideAxis(["Team_Name"])
	.render()
	.brushMode("1D-axes")
	.reorderable()
	.interactive();
     
    // create data table, row hover highlighting
var grid  = d3.divgrid();

d3.select("#grid0")
       .datum(data.slice(0,5))
       .call(grid)
       .selectAll(".row")
       .on({
         "mouseover": function(d0) { pc0.highlight([d0]) },
         "mouseout": pc0.unhighlight
    });
d3.select("#grid01")
      .datum(data)
      .call(grid)
      .selectAll(".row");

d3.select("#grid1")
       .datum(data.slice(0,5))
       .call(grid)
       .selectAll(".row")
       .on({
         "mouseover": function(d1) { pc0.highlight([d1]) },
         "mouseout": pc1.unhighlight
    });
d3.select("#grid11")
      .datum(data)
      .call(grid)
      .selectAll(".row");
      // update data table on brush event
    
pc0.on("brush", function(d0) {
       d3.select("#grid0")
      .datum(d0.slice(0,5))
      .call(grid)
      .selectAll(".row")
      .on({
        "mouseover": function(d0) { pc0.highlight([d0]) },
        "mouseout": pc0.unhighlight 
      });

      d3.select("#grid01")
      .datum(d0)
      .call(grid)
      .selectAll(".row");
});


    
pc1.on("brush", function(d1) {
       d3.select("#grid1")
      .datum(d1.slice(0,5))
      .call(grid)
      .selectAll(".row")
      .on({
        "mouseover": function(d1) { pc1.highlight([d1]) },
        "mouseout": pc1.unhighlight
      });

      d3.select("#grid11")
      .datum(d1)
      .call(grid)
      .selectAll(".row");

});
     // ********code to output chart1 vs chart2 *********
/*     
     var data1 = document.querySelector('#grid01').__data__;
     var data2 = document.querySelector('#grid11').__data__;
     console.log(data1);
     var chart1 = [];
     var chart2 = [];

     for (i=0; i<data1.length; i++) {
     	chart1.push(data1[i].team)
     }

     for (i=0; i<data2.length; i++) {
     	chart2.push(data2[i].team)
     }
*/
     function filtered_dataset(teams1, teams2, mainData) {
     	var l  = mainData.length,
     	    t1winCount = [],
     	    t2winCount = [];

     	for (var n=0; n<l; n++) {
     		var row = mainData[n],
     		    W = mainData[n].Winer,
     		    L = mainData[n].Loser;
     		if (include(teams1,W) &&
     			include(teams2,L)) {
                  t1winCount.push(row);
     		}
     		if (include(teams1,L) &&
     			include(teams2,W)) {
     			t2winCount.push(row)
     		}

     	}
     	return [t1winCount,t2winCount];
     };
     


     function include(arr,obj) {
       return (arr.indexOf(obj) != -1);
}


d3.csv('data/rsr2016.csv', function(data) {
  var table = d3.divgrid();

	d3.select("#compare").on("click", function() {

     var chart1 = [];
     var chart2 = [];
     var data1 = document.querySelector('#grid01').__data__;
     var data2 = document.querySelector('#grid11').__data__;

     for (i=0; i<data1.length; i++) {
     	chart1.push(data1[i].Team_Name)
     }

     for (i=0; i<data2.length; i++) {
     	chart2.push(data2[i].Team_Name)
     }
		
	var WinLose = filtered_dataset(chart1, chart2, data);

	d3.select("#t1wins").text(WinLose[0].length);
	d3.select("#t2wins").text(WinLose[1].length);
  
  d3.select("#table1")
      .datum(WinLose[0].slice(0,50))
      .call(table)
      .selectAll(".row");

  d3.select("#table2")
      .datum(WinLose[1].slice(0,50))
      .call(table)
      .selectAll(".row");    
});
});
     //*****************************************
 
	// smoothness
	d3.select("#smoothness").on("change", function() {
		d3.select("#smooth").text(this.value);
		pc0.smoothness(this.value).render();
		pc1.smoothness(this.value).render();
	});
	
	// bundling strength slider
	d3.select("#bundling").on("change", function() {
		d3.select("#strength").text(this.value);
		pc0.bundlingStrength(this.value).render();
		pc1.bundlingStrength(this.value).render();
	});
	
	
	var select0 = d3.select("#bundleDimension").append("select").on("change", changeBundle0);
	var select1 = d3.select("#bundleDimension").append("select").on("change", changeBundle1);
	
	var options0 = select0.selectAll('option')
		.data(d3.keys(pc0.dimensions()));

	var options1 = select1.selectAll('option')
		.data(d3.keys(pc1.dimensions()));
	
	options0
		.enter()
		.append("option")
		.attr("value", function(d) {return d;})
		.text(function(d) {return d;});

	options1
		.enter()
		.append("option")
		.attr("value", function(d) {return d;})
		.text(function(d) {return d;});
	
	//  d3.select("#grid1").style("visibility", "hidden");
    d3.select("#grid01").style("visibility", "hidden");
    d3.select("#grid11").style("visibility", "hidden");

	function changeBundle0() {
		pc0.bundleDimension(this.value);
	}
	function changeBundle1() {
		pc1.bundleDimension(this.value);
	}
	var test_function = function(selection) {
		return console.log(selection);
	}
});

</script>


