<!doctype html>
<head>
  <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
  <meta content="utf-8" http-equiv="encoding">
</head>
<title>Bundling Example</title>
<link rel="stylesheet" type="text/css" href="../d3.parcoords.css">
<link rel="stylesheet" type="text/css" href="../d3.slider.css">
<link rel="stylesheet" type="text/css" href="style.css">
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src="lib/sylvester.js"></script>
<script src="lib/lodash.js"></script>
<script src="lib/jquery-1.7.min.js"></script>
<script src="lib/underscore.js"></script>
<script src="lib/underscore.math.js"></script>
<script src="lib/d3.svg.multibrush.js"></script>
<script src="lib/divgrid.js"></script>
<script src="../d3.parcoords.js"></script>
<script src="../d3.slider.js"></script>


<style>
/* data table styles */
#grid { height: 198px; }
.row, .header { clear: left; font-size: 12px; line-height: 18px; height: 18px; }
.row:nth-child(odd) { background: rgba(0,0,0,0.05); }
.header { font-weight: bold; }
.cell { float: left; overflow: hidden; white-space: nowrap; width: 100px; height: 18px; }
.col-0 { width: 180px; }
</style>




<h3>Bundling</h3>
Bundling violates the point-line duality but can be used to visualize clusters using geometry only, leaving the color channel free
for other uses (e.g. statistical coloring, see below). Bundling can be achieved using different algorithms. Details on the algorithm
used here can be found in <a href="http://arxiv.org/abs/1109.6073">this paper.</a>
<p>Trying to learn how to output some value from the dataset <strong id="dataPoint">0.0</strong>

<p>Use this slider to change the curve smoothness. The current value is <strong id="smooth">0.0</strong><br/>
<input type="range" min="0" max="0.25" value="0.0" step="0.01" id="smoothness"/>
<p>Use this slider to change the bundling strength. The current value is <strong id="strength">0</strong><br/>
<input type="range" min="0" max="1" value="0" step="0.05" id="bundling"/>
<div id="bundleDimension">Bundle using clusters determined by: </div>
<div id="example0" class="parcoords" style="width:1140px;height:200px"></div>
<div id="example1" class="parcoords" style="width:1140px;height:200px"></div>

<p>
	<label>Win/Lose ratio between table1 and teble2:</label>
	<button id="compare">Compare</button>
</p>

<div id="grid0" style="width:1140px;height:250px"></div>
<div id="grid1" style="width:1140px;height:250px"></div>

<div id="grid01"></div>
<div id="grid11"></div>


<script>



var pc0;

d3.csv('data/avg2016stats.csv', function(data) {

pc0 = d3.parcoords()("#example0")
  .data(data)
	.bundlingStrength(0) // set bundling strength
	.smoothness(0)
	.bundleDimension("or")
	.showControlPoints(false)
	.hideAxis(["team"])
	.render()
	.brushMode("1D-axes")
	.reorderable()
	.interactive();

pc1 = d3.parcoords()("#example1")
  .data(data)
	.bundlingStrength(0) // set bundling strength
	.smoothness(0)
	.bundleDimension("or")
	.showControlPoints(false)
	.hideAxis(["team"])
	.render()
	.brushMode("1D-axes")
	.reorderable()
	.interactive();
     
    // create data table, row hover highlighting
var grid  = d3.divgrid();

d3.select("#grid0")
       .datum(data.slice(0,5))
       .call(grid)
       .selectAll(".row")
       .on({
         "mouseover": function(d0) { pc0.highlight([d0]) },
         "mouseout": pc0.unhighlight
    });
d3.select("#grid01")
      .datum(data)
      .call(grid)
      .selectAll(".row");

d3.select("#grid1")
       .datum(data.slice(0,5))
       .call(grid)
       .selectAll(".row")
       .on({
         "mouseover": function(d1) { pc0.highlight([d1]) },
         "mouseout": pc1.unhighlight
    });
d3.select("#grid11")
      .datum(data)
      .call(grid)
      .selectAll(".row");
      // update data table on brush event
    
pc0.on("brush", function(d0) {
       d3.select("#grid0")
      .datum(d0.slice(0,5))
      .call(grid)
      .selectAll(".row")
      .on({
        "mouseover": function(d0) { pc0.highlight([d0]) },
        "mouseout": pc0.unhighlight 
      });

      d3.select("#grid01")
      .datum(d0)
      .call(grid)
      .selectAll(".row");
});


    
pc1.on("brush", function(d1) {
       d3.select("#grid1")
      .datum(d1.slice(0,5))
      .call(grid)
      .selectAll(".row")
      .on({
        "mouseover": function(d1) { pc1.highlight([d1]) },
        "mouseout": pc1.unhighlight
      });

      d3.select("#grid11")
      .datum(d1)
      .call(grid)
      .selectAll(".row");

});
     // ********code to output chart1 vs chart2 *********
/*     
     var data1 = document.querySelector('#grid01').__data__;
     var data2 = document.querySelector('#grid11').__data__;
     console.log(data1);
     var chart1 = [];
     var chart2 = [];

     for (i=0; i<data1.length; i++) {
     	chart1.push(data1[i].team)
     }

     for (i=0; i<data2.length; i++) {
     	chart2.push(data2[i].team)
     }
*/
     function filtered_dataset(teams1, teams2, mainData) {
     	var l  = mainData.length,
     	    t1winCount = [],
     	    t2winCount = [];

     	for (var n=0; n<l; n++) {
     		var row = mainData[n],
     		    W = mainData[n].Wteam,
     		    L = mainData[n].Lteam;
     		if (include(teams1,W) &&
     			include(teams2,L)) {
                  t1winCount.push(row);
     		}
     		if (include(teams1,L) &&
     			include(teams2,W)) {
     			t2winCount.push(row)
     		}

     	}
     	return [t1winCount,t2winCount];
     };
     


     function include(arr,obj) {
       return (arr.indexOf(obj) != -1);
}


d3.csv('data/rsdr2016.csv', function(data) {


	d3.select("#compare").on("click", function(d) {

     var chart1 = [];
     var chart2 = [];
     var data1 = document.querySelector('#grid01').__data__;
     var data2 = document.querySelector('#grid11').__data__;

     for (i=0; i<data1.length; i++) {
     	chart1.push(data1[i].team)
     }

     for (i=0; i<data2.length; i++) {
     	chart2.push(data2[i].team)
     }
		
	var WinLose = filtered_dataset(chart1, chart2, data);
	
	console.log(WinLose);})
});
     //*****************************************
 
	// smoothness
	d3.select("#smoothness").on("change", function() {
		d3.select("#smooth").text(this.value);
		pc0.smoothness(this.value).render();
		pc1.smoothness(this.value).render();
	});
	
	// bundling strength slider
	d3.select("#bundling").on("change", function() {
		d3.select("#strength").text(this.value);
		pc0.bundlingStrength(this.value).render();
		pc1.bundlingStrength(this.value).render();
	});
	
	
	var select0 = d3.select("#bundleDimension").append("select").on("change", changeBundle0);
	var select1 = d3.select("#bundleDimension").append("select").on("change", changeBundle1);
	
	var options0 = select0.selectAll('option')
		.data(d3.keys(pc0.dimensions()));

	var options1 = select1.selectAll('option')
		.data(d3.keys(pc1.dimensions()));
	
	options0
		.enter()
		.append("option")
		.attr("value", function(d0) {return d0;})
		.text(function(d0) {return d0;});

	options1
		.enter()
		.append("option")
		.attr("value", function(d1) {return d1;})
		.text(function(d1) {return d1;});
	
	d3.select("#grid0").style("visibility", "hidden");
    d3.select("#grid01").style("visibility", "hidden");
    d3.select("#grid11").style("visibility", "hidden");

	function changeBundle0() {
		pc0.bundleDimension(this.value);
	}
	function changeBundle1() {
		pc1.bundleDimension(this.value);
	}
	var test_function = function(selection) {
		return console.log(selection);
	}
});

</script>


